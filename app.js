const $=(q,r)=> (r||document).querySelector(q); const $$=(q,r)=> Array.from((r||document).querySelectorAll(q)); document.addEventListener('DOMContentLoaded',()=>{ $$('.tab').forEach(t=>t.addEventListener('click',()=>{const trg=t.getAttribute('data-target'); $$('.tab').forEach(b=>b.classList.toggle('active',b===t)); $$('.view').forEach(v=>v.classList.toggle('active',v.id==='view-'+trg));})); if(typeof fetchModel==='function'){ fetchModel((m)=>{ const ppl=$('#peopleOnline'); if(ppl) ppl.textContent=(m.people||[]).filter(p=>p.onlineSmart||p.onlineRaw).length; const hs=$('#houseStatus'); if(hs) hs.textContent=m.notte?'Notte':'Giorno'; const ek=$('#energyKwh'); if(ek) ek.textContent=(m.energy&&m.energy.kwh!=null)?m.energy.kwh:'â€”'; const tv=$('#tempValue'); if(tv && m.weather && typeof m.weather.tempC==='number') tv.textContent=Math.round(m.weather.tempC); const hv=$('#humValue'); if(hv && typeof m.weather?.humidity==='number') hv.textContent=Math.round(m.weather.humidity); const ts=$('#ts'); if(ts && m.meta) ts.textContent='Aggiornamento: '+new Date(m.meta.nowIso).toLocaleTimeString('it-IT',{hour:'2-digit',minute:'2-digit'}); }, console.error); } });